import{a as A,b as L}from"./chunk-PA3RXIL6.js";import{a as D}from"./chunk-QPFGTPJK.js";import{a as B}from"./chunk-BLXWA4ID.js";import"./chunk-3W6LJROD.js";import{R,U as M,V as N,W as T,X as k,aa as F,g as x,ka as U,m as S,ma as j}from"./chunk-TEIXOV6V.js";import{Fa as v,Hb as y,Kb as I,O as b,Ra as f,Sa as g,T as a,Wa as _,Xa as s,Y as P,Ya as n,Z as h,Za as E,ea as z,fb as C,ib as c,jb as l,o as m,sa as d,sb as p,ub as w}from"./chunk-5T4QEHQE.js";import"./chunk-6GMPNWKN.js";import"./chunk-GIEMQNDR.js";import"./chunk-WQS6UKMC.js";import"./chunk-HVWPZZJ7.js";import"./chunk-HSZY262W.js";import"./chunk-VSDHJBUA.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-NWJ5J3BN.js";var u=class i{baseURL(e,o){return B.apiURL+`usuarios/${e}/pozos/${o}`}httpClient=a(x);auth=a(D);getUserIdOrThrow(){let e=this.auth.userId();if(!e)throw new Error("No se encontr\xF3 id_usuario autenticado");return e}async editPozo(e,o){let t=this.getUserIdOrThrow();try{return await m(this.httpClient.put(this.baseURL(t,e),o))}catch(r){throw console.log("Mensaje de error",r.error.message),r.status===0?new Error(r.message):new Error(r.error.message)}}async getPozoById(e){let o=this.getUserIdOrThrow();try{return await m(this.httpClient.get(this.baseURL(o,e)))}catch(t){throw console.log("Mensaje de error",t.error?.message??t.message),t.status===0?new Error(t.message):new Error(t.error?.message??"Error al obtener usuario")}}static \u0275fac=function(o){return new(o||i)};static \u0275prov=b({token:i,factory:i.\u0275fac,providedIn:"root"})};function q(i,e){if(i&1){let o=C();s(0,"app-pozos-form",6),c("saved",function(r){P(o);let O=l();return h(O.handleEdit(r))}),n()}if(i&2){let o=l();_("pozo",o.pozoResource.value())("id_pozo",o.id_pozo())("agregareditar",!0)}}function G(i,e){i&1&&E(0,"ion-spinner")}function H(i,e){i&1&&(s(0,"p"),p(1,"No hay pozo"),n())}function J(i,e){if(i&1&&(s(0,"div",5),p(1),n()),i&2){let o=l();d(),w(" ",o.errorMessage()," ")}}var V=class i{pozoEditService=a(u);router=a(S);id_pozo=I.required();fotoPozoService=a(L);pozoResource=y({params:()=>({idPozo:this.id_pozo()}),loader:({params:e})=>this.pozoEditService.getPozoById(e.idPozo)});errorMessage=z("");disabled=z(!1);async handleEdit(e){try{let o=e.pozo.id_propietario;this.disabled.set(!0);let t=await this.pozoEditService.editPozo(this.id_pozo(),e.pozo);e.foto&&await this.fotoPozoService.subirFoto(o,this.id_pozo(),e.foto),console.log("Perforacion editada",t),this.router.navigate(["pozos-list"])}catch(o){this.errorMessage.set(o.message)}this.disabled.set(!1)}irAtras(){this.router.navigate(["pozos-list"])}static \u0275fac=function(o){return new(o||i)};static \u0275cmp=v({type:i,selectors:[["app-pozo-edit"]],inputs:{id_pozo:[1,"id_pozo"]},decls:15,vars:3,consts:[[1,"ion-padding"],["slot","start","color","primary"],["default-href","#","color","primary",3,"click"],[3,"pozo","id_pozo","agregareditar"],["fill","outline","expand","block",3,"click","disabled"],[1,"error-message"],[3,"saved","pozo","id_pozo","agregareditar"]],template:function(o,t){o&1&&(s(0,"ion-content",0)(1,"ion-content")(2,"ion-toolbar")(3,"ion-buttons",1)(4,"ion-back-button",2),c("click",function(){return t.irAtras()}),n()()(),s(5,"ion-card")(6,"ion-card-content")(7,"h2"),p(8,"Editar pozo"),n(),f(9,q,1,3,"app-pozos-form",3)(10,G,1,0,"ion-spinner")(11,H,2,0,"p"),s(12,"ion-button",4),c("click",function(){return t.pozoResource.reload()}),p(13," RECARGAR "),n(),f(14,J,2,1,"div",5),n()()()()),o&2&&(d(9),g(t.pozoResource.hasValue()?9:t.pozoResource.isLoading()?10:11),d(3),_("disabled",t.disabled()),d(2),g(t.errorMessage()?14:-1))},dependencies:[M,F,U,T,k,A,j,N,R],encapsulation:2})};export{V as PozoEditPage};
