import{a as F}from"./chunk-WBBBMSH4.js";import{a as L}from"./chunk-QPFGTPJK.js";import{a as j}from"./chunk-BLXWA4ID.js";import"./chunk-3W6LJROD.js";import{R,U as S,V as T,W as B,X as M,aa as k,g as P,ka as $,m as z,ma as D,oa as U}from"./chunk-TEIXOV6V.js";import{Fa as y,Hb as x,Kb as h,O as A,Ra as g,Sa as b,T as a,Wa as f,Xa as s,Y as E,Ya as n,Z as C,Za as w,ea as _,fb as N,ib as c,jb as u,o as v,sa as p,sb as d,ub as I}from"./chunk-5T4QEHQE.js";import"./chunk-6GMPNWKN.js";import"./chunk-GIEMQNDR.js";import"./chunk-WQS6UKMC.js";import"./chunk-HVWPZZJ7.js";import"./chunk-HSZY262W.js";import"./chunk-VSDHJBUA.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-NWJ5J3BN.js";var m=class i{baseURL(t,e){return j.apiURL+`usuarios/${t}/pozos/${e}`}httpClient=a(P);auth=a(L);getUserIdOrThrow(){let t=this.auth.userId();if(!t)throw new Error("No se encontr\xF3 id_usuario autenticado");return t}async editNivelAporte(t,e,o){let r=this.getUserIdOrThrow();try{return await v(this.httpClient.put(`${this.baseURL(r,t)}/niveles_aporte/${e}`,o))}catch(l){throw console.log("Mensaje de error",l.error.message),l.status===0?new Error(l.message):new Error("La prufundidad debe ser >= 0")}}async getNivelById(t,e){let o=this.getUserIdOrThrow();try{return await v(this.httpClient.get(`${this.baseURL(o,t)}/niveles_aporte/${e}`))}catch(r){throw console.log("Mensaje de error",r.error?.message??r.message),r.status===0?new Error(r.message):new Error(r.error?.message??"Error al obtener nivel de aporte")}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=A({token:i,factory:i.\u0275fac,providedIn:"root"})};function q(i,t){if(i&1){let e=N();s(0,"app-aportes-form",6),c("saved",function(r){E(e);let l=u();return C(l.handleEdit(r))}),n()}if(i&2){let e=u();f("nivelAporte",e.nivelResource.value())}}function G(i,t){i&1&&w(0,"ion-spinner")}function H(i,t){i&1&&(s(0,"p"),d(1,"No se encontr\xF3 el nivel de aporte"),n())}function J(i,t){if(i&1&&(s(0,"div",5),d(1),n()),i&2){let e=u();p(),I(" ",e.errorMessage()," ")}}var V=class i{nivelAporteService=a(m);toastController=a(U);router=a(z);errorMessage=_("");disabled=_(!1);id_pozo=h.required();id_nivel_aporte=h.required();nivelResource=x({params:()=>({idPozo:this.id_pozo(),idNivel:this.id_nivel_aporte()}),loader:({params:t})=>this.nivelAporteService.getNivelById(t.idPozo,t.idNivel)});async handleEdit(t){try{let e=this.id_pozo(),o=this.id_nivel_aporte();this.disabled.set(!0);let r=await this.nivelAporteService.editNivelAporte(e,o,t);console.log("Perforacion editada",r),this.router.navigate([`pozos/${e}/aportes-list`])}catch(e){await(await this.toastController.create({message:e.message,duration:1e3,position:"bottom",color:"danger",animated:!0})).present()}this.disabled.set(!1)}irAtras(){this.router.navigate([`pozos/${this.id_pozo()}/aportes-list`])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=y({type:i,selectors:[["app-aportes-edit"]],inputs:{id_pozo:[1,"id_pozo"],id_nivel_aporte:[1,"id_nivel_aporte"]},decls:14,vars:3,consts:[[1,"ion-padding"],["slot","start","color","primary"],["default-href","#","color","primary",3,"click"],[3,"nivelAporte"],["fill","outline","expand","block",3,"click","disabled"],[1,"error-message"],[3,"saved","nivelAporte"]],template:function(e,o){e&1&&(s(0,"ion-content",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-back-button",2),c("click",function(){return o.irAtras()}),n()()(),s(4,"ion-card")(5,"ion-card-content")(6,"h2"),d(7,"Editar nivel de aporte"),n(),g(8,q,1,1,"app-aportes-form",3)(9,G,1,0,"ion-spinner")(10,H,2,0,"p"),s(11,"ion-button",4),c("click",function(){return o.nivelResource.reload()}),d(12," RECARGAR "),n(),g(13,J,2,1,"div",5),n()()()),e&2&&(p(8),b(o.nivelResource.hasValue()?8:o.nivelResource.isLoading()?9:10),p(3),f("disabled",o.disabled()),p(2),b(o.errorMessage()?13:-1))},dependencies:[k,B,M,F,$,S,D,T,R],encapsulation:2})};export{V as AportesEditPage};
