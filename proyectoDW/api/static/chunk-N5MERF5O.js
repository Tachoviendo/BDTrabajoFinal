import{a as j}from"./chunk-752EIIM4.js";import{a as U}from"./chunk-QPFGTPJK.js";import{a as N}from"./chunk-BLXWA4ID.js";import"./chunk-3W6LJROD.js";import{U as M,W as P,X as T,aa as B,g as I,m as R}from"./chunk-TEIXOV6V.js";import{Fa as E,Hb as w,Kb as x,O as h,Ra as g,Sa as f,T as n,Wa as S,Xa as a,Y as _,Ya as s,Z as v,ea as p,fb as y,ib as b,jb as l,o as u,sa as d,sb as c,ub as C}from"./chunk-5T4QEHQE.js";import"./chunk-6GMPNWKN.js";import"./chunk-GIEMQNDR.js";import"./chunk-WQS6UKMC.js";import"./chunk-HVWPZZJ7.js";import"./chunk-HSZY262W.js";import"./chunk-VSDHJBUA.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-NWJ5J3BN.js";var m=class t{baseURL(e,i){return N.apiURL+`usuarios/${e}/sitios/${i}`}httpClient=n(I);authService=n(U);getUserIdOrThrow(){let e=this.authService.userId();if(!e)throw new Error("No se encontr\xF3 id_usuario autenticado");return e}async editSitio(e,i){let o=this.getUserIdOrThrow();try{return await u(this.httpClient.put(this.baseURL(o,e),i))}catch(r){throw console.log("Mensaje de error",r.error.message),r.status===0?new Error(r.message):new Error(r.error.message)}}async getSitioById(e){let i=this.getUserIdOrThrow();try{return await u(this.httpClient.get(this.baseURL(i,e)))}catch(o){throw console.log("Mensaje de error",o.error?.message??o.message),o.status===0?new Error(o.message):new Error(o.error?.message??"Error al obtener sitio")}}static \u0275fac=function(i){return new(i||t)};static \u0275prov=h({token:t,factory:t.\u0275fac,providedIn:"root"})};function F(t,e){if(t&1){let i=y();a(0,"app-sitios-form",4),b("saved",function(r){_(i);let k=l();return v(k.handleEdit(r))}),s()}if(t&2){let i=l();S("sitio",i.sitioResource.value())}}function L(t,e){t&1&&(a(0,"p"),c(1,"No hay usuario"),s())}function A(t,e){if(t&1&&(a(0,"div",3),c(1),s()),t&2){let i=l();d(),C(" ",i.errorMessage()," ")}}var D=class t{editSitioService=n(m);id_sitio=x.required();router=n(R);sitioResource=w({params:()=>({id:this.id_sitio()}),loader:({params:e})=>this.editSitioService.getSitioById(e.id)});errorMessage=p("");disabled=p(!1);async handleEdit(e){try{this.disabled.set(!0);let i=await this.editSitioService.editSitio(this.id_sitio(),e);console.log("Sitio editado",i),this.router.navigate(["/sitios-list"])}catch(i){this.errorMessage.set(i.message)}this.disabled.set(!1)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=E({type:t,selectors:[["app-sitios-edit"]],inputs:{id_sitio:[1,"id_sitio"]},decls:10,vars:3,consts:[[1,"ion-padding"],[3,"sitio"],["fill","outline","expand","block",3,"click","disabled"],[1,"error-message"],[3,"saved","sitio"]],template:function(i,o){i&1&&(a(0,"ion-content",0)(1,"ion-card")(2,"ion-card-content")(3,"h2"),c(4,"Editar sitio"),s(),g(5,F,1,1,"app-sitios-form",1)(6,L,2,0,"p"),a(7,"ion-button",2),b("click",function(){return o.sitioResource.reload()}),c(8," RECARGAR "),s(),g(9,A,2,1,"div",3),s()()()),i&2&&(d(5),f(o.sitioResource.hasValue()?5:6),d(2),S("disabled",o.disabled()),d(2),f(o.errorMessage()?9:-1))},dependencies:[B,P,T,j,M],encapsulation:2})};export{D as SitiosEditPage};
